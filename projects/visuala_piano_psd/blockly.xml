<xml xmlns="http://www.w3.org/1999/xhtml"><block type="comments_comment" x="-190" y="50"><field name="TEXT">APP START
-----------------
Load all available notes,only then enable the piano,
otherwise we might not hear anything at first.</field><next><block type="on_document_ready"><statement name="DO"><block type="variables_set"><field name="VAR">notesLoadedNum</field><value name="VALUE"><block type="math_number"><field name="NUM">0</field></block></value><next><block type="text_print"><value name="TEXT"><block type="text"><field name="TEXT">Loading audio</field></block></value><next><block type="layer_loadAudio"><field name="LOOP">FALSE</field><value name="LAYER"><block type="text"><field name="TEXT">C</field></block></value><value name="AUDIO_URL"><block type="text"><field name="TEXT">data/C.mp3</field></block></value><statement name="ONLOADED"><block type="procedures_callnoreturn"><mutation name="tryToEnableKeyboard"></mutation></block></statement><next><block type="layer_loadAudio"><field name="LOOP">FALSE</field><value name="LAYER"><block type="text"><field name="TEXT">D</field></block></value><value name="AUDIO_URL"><block type="text"><field name="TEXT">data/D.mp3</field></block></value><statement name="ONLOADED"><block type="procedures_callnoreturn"><mutation name="tryToEnableKeyboard"></mutation></block></statement><next><block type="layer_loadAudio"><field name="LOOP">FALSE</field><value name="LAYER"><block type="text"><field name="TEXT">E</field></block></value><value name="AUDIO_URL"><block type="text"><field name="TEXT">data/E.mp3</field></block></value><statement name="ONLOADED"><block type="procedures_callnoreturn"><mutation name="tryToEnableKeyboard"></mutation></block></statement><next><block type="layer_loadAudio"><field name="LOOP">FALSE</field><value name="LAYER"><block type="text"><field name="TEXT">C_</field></block></value><value name="AUDIO_URL"><block type="text"><field name="TEXT">data/C_.mp3</field></block></value><statement name="ONLOADED"><block type="procedures_callnoreturn"><mutation name="tryToEnableKeyboard"></mutation></block></statement><next><block type="layer_loadAudio"><field name="LOOP">FALSE</field><value name="LAYER"><block type="text"><field name="TEXT">D_</field></block></value><value name="AUDIO_URL"><block type="text"><field name="TEXT">data/D_.mp3</field></block></value><statement name="ONLOADED"><block type="procedures_callnoreturn"><mutation name="tryToEnableKeyboard"></mutation></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block></next></block><block type="procedures_defnoreturn" x="430" y="50"><field name="NAME">tryToEnableKeyboard</field><statement name="STACK"><block type="comments_comment"><field name="TEXT">Just take note of how many notes we have loaded</field><next><block type="variables_set"><field name="VAR">notesLoadedNum</field><value name="VALUE"><block type="math_arithmetic"><field name="OP">ADD</field><value name="A"><block type="variables_get"><field name="VAR">notesLoadedNum</field></block></value><value name="B"><block type="math_number"><field name="NUM">1</field></block></value></block></value><next><block type="comments_comment"><field name="TEXT">Once we have all the notes loaded we can start listening for key clicks / taps</field><next><block type="controls_if"><value name="IF0"><block type="logic_compare"><field name="OP">EQ</field><value name="A"><block type="variables_get"><field name="VAR">notesLoadedNum</field></block></value><value name="B"><block type="math_number"><field name="NUM">5</field></block></value></block></value><statement name="DO0"><block type="text_print"><value name="TEXT"><block type="text"><field name="TEXT">Audio loaded</field></block></value><next><block type="comments_comment"><field name="TEXT">As soon as all notes are loaded add listeners to the keys</field><next><block type="on_mousedown"><value name="TEXT"><block type="photoshop_layer_name"><field name="TEXT">key</field></block></value><statement name="DO"><block type="comments_comment"><field name="TEXT">A little effect, this fades in the pressed layer when we hold mouse over key layer, 
to give an illusion of pressing the keyboard key.</field><next><block type="layer_select_this"><value name="BLOCK"><block type="layer_find"><value name="VALUE"><block type="text"><field name="TEXT">.pressed</field></block></value><value name="BLOCK"><block type="layer_show"></block></value></block></value><next><block type="comments_comment"><field name="TEXT">Get the property named "noteName", which we assigned in the layer properties earlier. Then we can 
play the right mp3 audio for each note.</field><next><block type="variables_set"><field name="VAR">noteName</field><value name="VALUE"><block type="layer_getThisProperty"><value name="VALUE"><block type="text"><field name="TEXT">note</field></block></value></block></value><next><block type="layer_stopAudio"><value name="LAYER"><block type="variables_get"><field name="VAR">noteName</field></block></value><next><block type="layer_playAudio"><value name="LAYER"><block type="variables_get"><field name="VAR">noteName</field></block></value></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type="on_mouseup"><value name="TEXT"><block type="photoshop_layer_name"><field name="TEXT">key</field></block></value><statement name="DO"><block type="comments_comment"><field name="TEXT">As soon as we release the key we should fade in the "pressed" layer again so the key
returns to the original unpressed state.</field><next><block type="layer_select_this"><value name="BLOCK"><block type="layer_find"><value name="VALUE"><block type="text"><field name="TEXT">.pressed</field></block></value><value name="BLOCK"><block type="layer_hide"></block></value></block></value></block></next></block></statement></block></next></block></next></block></next></block></statement></block></next></block></next></block></next></block></statement></block></xml>
